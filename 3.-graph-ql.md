# 3. GRAPH QL

#### GraphQL con Deno

**Teoría**

GraphQL es un lenguaje de consulta para APIs y un tiempo de ejecución para ejecutar esas consultas con los datos existentes. GraphQL proporciona una descripción completa y comprensible de los datos en tu API, da a los clientes el poder de pedir exactamente lo que necesitan y nada más, facilita la evolución de las APIs a lo largo del tiempo y permite herramientas de desarrollo potentes.

**Principales conceptos de GraphQL:**

1. **Schema**: Define la estructura de la API, especificando qué tipos de datos están disponibles y cómo se pueden consultar esos datos.
2. **Types**: Los tipos en GraphQL representan la forma de los datos. Los tipos básicos incluyen `Query`, `Mutation`, y tipos personalizados.
3. **Query**: Permite a los clientes solicitar datos.
4. **Mutation**: Permite a los clientes modificar datos.
5. **Resolver**: Una función que resuelve un valor para un tipo o campo en el esquema.

#### Implementación de GraphQL con Deno y Apollo Server

**Paso 1: Configuración del Entorno**

Asegúrate de tener Deno instalado en tu sistema.

**Paso 2: Crear el Proyecto**

Crea una carpeta para tu proyecto y navega a ella en tu terminal.

```sh
mkdir graphql-deno
cd graphql-deno
```

**Paso 3: Configurar Apollo Server**

Crea un archivo `server.ts` y añade el siguiente código para configurar Apollo Server con Deno.

```typescript
import { ApolloServer } from "https://deno.land/x/apollo_server@v2.1.0/mod.ts";
import { gql } from "https://deno.land/x/graphql_tag@0.1.0/mod.ts";

// Definir el esquema
const typeDefs = gql`
  type Query {
    hello: String
    users: [User]
  }

  type User {
    id: ID!
    name: String!
  }

  type Mutation {
    addUser(name: String!): User
  }
`;

// Datos de ejemplo
let users = [
  { id: "1", name: "Alice" },
  { id: "2", name: "Bob" },
];

// Definir resolvers
const resolvers = {
  Query: {
    hello: () => "Hello, Deno!",
    users: () => users,
  },
  Mutation: {
    addUser: (_: any, { name }: { name: string }) => {
      const newUser = { id: String(users.length + 1), name };
      users.push(newUser);
      return newUser;
    },
  },
};

// Crear una instancia del servidor
const server = new ApolloServer({ typeDefs, resolvers });

// Iniciar el servidor
server.listen({ port: 8000 }).then(({ url }: { url: string }) => {
  console.log(`Server running on ${url}`);
});
```

**Explicación del Código:**

1. **Importar `ApolloServer` y `gql`**: Usamos Apollo Server para manejar las solicitudes GraphQL y `gql` para definir el esquema.
2. **Definir el esquema (`typeDefs`)**: Define los tipos `Query`, `Mutation` y `User`.
   * `Query`: Define las operaciones de lectura (`hello` y `users`).
   * `User`: Define el tipo de dato `User`.
   * `Mutation`: Define las operaciones de escritura (`addUser`).
3. **Datos de ejemplo**: Una lista simple de usuarios.
4. **Definir resolvers**: Funciones que resuelven los valores para las consultas y mutaciones definidas en el esquema.
5. **Crear e iniciar el servidor**: Se crea una instancia de Apollo Server y se inicia en el puerto 8000.

**Ejecutar el Servidor**

Para ejecutar el servidor, abre tu terminal y corre el siguiente comando:

```sh
deno run --allow-net --allow-env server.ts
```

Esto inicia el servidor en `http://localhost:8000`.

**Consultas y Mutaciones**

Ahora que el servidor está en funcionamiento, puedes realizar consultas y mutaciones usando una herramienta como [GraphQL Playground](https://www.apollographql.com/docs/apollo-server/testing/graphql-playground/).

**Consulta (Query)**

```graphql
{
  hello
  users {
    id
    name
  }
}
```

**Mutación (Mutation)**

```graphql
mutation {
  addUser(name: "Charlie") {
    id
    name
  }
}
```

#### &#x20;Deno y Apollo Server proporciona una forma eficiente y flexible de manejar consultas y mutaciones de datos. Al definir un esquema claro y resolvers correspondientes, puedes crear APIs potentes que permiten a los clientes solicitar exactamente los datos que necesitan, optimizando así la transferencia de datos y mejorando el rendimiento de las aplicaciones.
