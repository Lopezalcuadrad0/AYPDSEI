# 2. API REST

#### API Rest con Deno

**Teoría**

Una API Rest (Representational State Transfer) es una arquitectura de software que permite la comunicación entre sistemas a través de HTTP, utilizando métodos como GET, POST, PUT, DELETE, entre otros. Las APIs Restful se caracterizan por su simplicidad y flexibilidad, permitiendo que diferentes aplicaciones puedan comunicarse entre sí, independientemente de su lenguaje de programación o plataforma.

**Características Principales de una API Rest:**

1. **Cliente-Servidor**: La arquitectura separa las responsabilidades del cliente y del servidor.
2. **Sin Estado**: Cada petición del cliente al servidor debe contener toda la información necesaria para entender y procesar la solicitud.
3. **Cacheable**: Las respuestas deben indicar si son cacheables o no, para mejorar el rendimiento mediante la reutilización de respuestas anteriores.
4. **Interfaz Uniforme**: Utiliza una interfaz uniforme para facilitar la interacción con los recursos.
5. **Sistemas en Capas**: La arquitectura puede estar compuesta de capas, permitiendo que diferentes niveles de servidores puedan trabajar juntos.

**Métodos HTTP Comunes:**

* **GET**: Recuperar datos de un servidor.
* **POST**: Enviar datos al servidor para crear un nuevo recurso.
* **PUT**: Actualizar completamente un recurso existente en el servidor.
* **PATCH**: Actualizar parcialmente un recurso existente en el servidor.
* **DELETE**: Eliminar un recurso existente en el servidor.

Entiendo, si deseas crear una API REST con Deno sin usar `oak`, podemos hacerlo utilizando las funcionalidades nativas de Deno. A continuación, te mostraré cómo hacerlo paso a paso.

#### API Rest con Deno (sin `oak`)

**Teoría**

Una API REST permite la comunicación entre diferentes sistemas mediante solicitudes HTTP. Los métodos HTTP comunes son:

* **GET**: Recuperar datos.
* **POST**: Enviar datos para crear un nuevo recurso.
* **PUT**: Actualizar completamente un recurso existente.
* **PATCH**: Actualizar parcialmente un recurso existente.
* **DELETE**: Eliminar un recurso existente.

Deno proporciona una forma segura y moderna de ejecutar aplicaciones JavaScript y TypeScript, incluyendo la creación de servidores HTTP.

**Ejemplo de API REST con Deno**

**Paso 1: Configuración del Entorno**

DENO

**Paso 2: Crear el Servidor**

Crea un archivo `server.ts` y añade el siguiente código para configurar un servidor básico.

```typescript
import { serve } from "https://deno.land/std@0.106.0/http/server.ts";

const server = serve({ port: 8000 });
console.log("Server running on http://localhost:8000");

for await (const req of server) {
  let bodyContent = "Hello, Deno!";

  if (req.url === "/users" && req.method === "GET") {
    bodyContent = JSON.stringify([{ name: "Alice" }, { name: "Bob" }]);
  } else if (req.url === "/users" && req.method === "POST") {
    const body = await req.body({ type: "json" });
    bodyContent = JSON.stringify({ message: "User created", user: body });
  }

  req.respond({ body: bodyContent });
}
```

**Explicación del Código:**

1. **Importar `serve` desde `deno.land/std`**: Usamos el módulo estándar de Deno para crear un servidor HTTP.
2. **Crear una instancia del servidor**: Configuramos el servidor para escuchar en el puerto 8000.
3. **Manejo de Solicitudes**: Utilizamos un bucle `for await` para manejar las solicitudes entrantes:
   * **GET `/users`**: Devuelve una lista de usuarios.
   * **POST `/users`**: Crea un nuevo usuario a partir de los datos enviados en la solicitud.

**Ejecutar el Servidor**

Para ejecutar el servidor, abre tu terminal y corre el siguiente comando:

```sh
deno run --allow-net server.ts
```

Esto inicia el servidor en `http://localhost:8000`.

**Métodos Avanzados**

**PUT y DELETE**

Para completar la API, añadamos las rutas PUT y DELETE para actualizar y eliminar usuarios.

```typescript
import { serve } from "https://deno.land/std@0.106.0/http/server.ts";

const server = serve({ port: 8000 });
console.log("Server running on http://localhost:8000");

const users = [{ id: 1, name: "Alice" }, { id: 2, name: "Bob" }];

for await (const req of server) {
  let bodyContent = "Hello, Deno!";
  const { method, url } = req;

  if (url === "/users" && method === "GET") {
    bodyContent = JSON.stringify(users);
  } else if (url === "/users" && method === "POST") {
    const body = await req.json();
    users.push(body);
    bodyContent = JSON.stringify({ message: "User created", user: body });
  } else if (url.startsWith("/users/") && method === "PUT") {
    const id = parseInt(url.split("/")[2]);
    const body = await req.json();
    const userIndex = users.findIndex((u) => u.id === id);
    if (userIndex > -1) {
      users[userIndex] = { ...users[userIndex], ...body };
      bodyContent = JSON.stringify({ message: `User ${id} updated`, user: users[userIndex] });
    } else {
      bodyContent = JSON.stringify({ message: `User ${id} not found` });
    }
  } else if (url.startsWith("/users/") && method === "DELETE") {
    const id = parseInt(url.split("/")[2]);
    const userIndex = users.findIndex((u) => u.id === id);
    if (userIndex > -1) {
      users.splice(userIndex, 1);
      bodyContent = JSON.stringify({ message: `User ${id} deleted` });
    } else {
      bodyContent = JSON.stringify({ message: `User ${id} not found` });
    }
  }

  req.respond({ body: bodyContent });
}
```

**Explicación:**

1. **Gestión de Usuarios**: Utilizamos un array `users` para almacenar los usuarios.
2. **PUT `/users/:id`**: Actualiza un usuario específico basado en su ID.
3. **DELETE `/users/:id`**: Elimina un usuario específico basado en su ID.
